<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediTrack - Medicine Analyser</title>
    <style>
        * { 
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #f5f7fa;
        }

        .main-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .logo {
            padding: 30px 20px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            text-decoration: none;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.1);
            padding-left: 30px;
        }

        .content {
            margin-left: 260px;
            flex: 1;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .search-box input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-box button {
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .search-box button:hover {
            transform: translateY(-2px);
        }

        .results {
            display: none;
        }

        .results.active {
            display: block;
        }

        .result-section {
            margin-bottom: 30px;
        }

        .result-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 22px;
        }

        .result-content {
            background: #f5f7fa;
            padding: 20px;
            border-radius: 10px;
            line-height: 1.8;
        }

        .result-content p {
            margin-bottom: 15px;
            color: #333;
        }

        .result-content ul {
            margin-left: 20px;
            color: #666;
        }

        .result-content li {
            margin-bottom: 8px;
        }

        .medicine-card {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .medicine-card:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .medicine-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .medicine-card p {
            color: #666;
            margin-bottom: 8px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .example-searches {
            margin-top: 20px;
        }

        .example-searches h4 {
            color: #666;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .example-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .example-tag {
            background: #e3f2fd;
            color: #667eea;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .example-tag:hover {
            background: #667eea;
            color: white;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .content {
                margin-left: 0;
            }

            .search-box {
                flex-direction: column;
            }

            .search-box button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="sidebar">
            <div class="logo">üíä MediTrack</div>
            <div class="menu">
                <a href="dashboard.html" class="menu-item"><span>üìä</span> Dashboard</a>
                <a href="dashboard.html#progress" class="menu-item"><span>üìà</span> Progress</a>
                <a href="dashboard.html#history" class="menu-item"><span>üìú</span> History</a>
                <a href="medicine-analyser.html" class="menu-item" style="background: rgba(255,255,255,0.2);"><span>üî¨</span> Medicine Analyser</a>
                <a href="profile.html" class="menu-item"><span>üë§</span> Profile</a>
                <a href="settings.html" class="menu-item"><span>‚öôÔ∏è</span> Settings</a>
                <a href="#" class="menu-item" onclick="logout()"><span>üö™</span> Logout</a>
            </div>
        </div>

        <div class="content">
            <div class="header">
                <h1 data-translate="analyser">üî¨ Medicine Analyser</h1>
                <p style="color: #666; margin-top: 10px;">Search for medicine information or find medicines for specific symptoms</p>
            </div>

            <div class="card">
                <div class="search-box">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Enter medicine name or symptom (e.g., 'Paracetamol' or 'fever')"
                        data-translate-placeholder="searchMedicine"
                    >
                    <button onclick="searchMedicine()" data-translate="searchBtn">Search</button>
                </div>

                <div class="example-searches">
                    <h4>Example Searches:</h4>
                    <div class="example-tags">
                        <span class="example-tag" onclick="quickSearch('Paracetamol')">Paracetamol</span>
                        <span class="example-tag" onclick="quickSearch('Ibuprofen')">Ibuprofen</span>
                        <span class="example-tag" onclick="quickSearch('fever')">Fever</span>
                        <span class="example-tag" onclick="quickSearch('headache')">Headache</span>
                        <span class="example-tag" onclick="quickSearch('cold')">Cold</span>
                        <span class="example-tag" onclick="quickSearch('cough')">Cough</span>
                        <span class="example-tag" onclick="quickSearch('diabetes')">Diabetes</span>
                        <span class="example-tag" onclick="quickSearch('blood pressure')">Blood Pressure</span>
                    </div>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p data-translate="analyzing">Analyzing...</p>
            </div>

            <div class="results" id="results">
                <div class="card">
                    <div class="result-section">
                        <h3 id="resultTitle"></h3>
                        <div class="result-content" id="resultContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="translations.js"></script>
    <script>
        function quickSearch(query) {
            document.getElementById('searchInput').value = query;
            searchMedicine();
        }

        async function searchMedicine() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                alert('Please enter a medicine name or symptom');
                return;
            }

            // Show loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('results').classList.remove('active');

            try {
                // Call Gemini API
                const apiKey = 'AIzaSyDjhZqFGJmK5Z0Q4Q4Q4Q4Q4Q4Q4Q4Q4Q4'; // Replace with actual API key
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `As a medical information assistant, provide detailed information about: "${query}". 
                                
If it's a medicine name, include:
1. What it is used for
2. Common dosages and strengths (e.g., 50mg, 100mg, 500mg)
3. How to take it
4. Common side effects
5. Important precautions
6. How much water should be taken with it

If it's a symptom, suggest:
1. Common medicines used for this condition
2. Dosage information for each medicine
3. When to take them
4. Important warnings

Format the response in a clear, organized way with headings and bullet points.`
                            }]
                        }]
                    })
                });

                const data = await response.json();
                const resultText = data.candidates[0].content.parts[0].text;

                // Display results
                displayResults(query, resultText);
            } catch (error) {
                console.error('Error:', error);
                displayResults(query, getDefaultResponse(query));
            }

            // Hide loading
            document.getElementById('loading').classList.remove('active');
        }

        function displayResults(query, content) {
            const results = document.getElementById('results');
            const title = document.getElementById('resultTitle');
            const contentDiv = document.getElementById('resultContent');

            title.textContent = `Information about: ${query}`;
            
            // Format the content with proper HTML
            const formattedContent = content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n- /g, '<li>')
                .replace(/\n/g, '<br>');

            contentDiv.innerHTML = `<p>${formattedContent}</p>`;

            results.classList.add('active');
        }

        function getDefaultResponse(query) {
            // Default responses for common queries
            const lowerQuery = query.toLowerCase();
            
            if (lowerQuery.includes('paracetamol') || lowerQuery.includes('acetaminophen')) {
                return `**Paracetamol (Acetaminophen)**

**Uses:**
- Pain relief (headaches, toothaches, muscle aches)
- Fever reduction

**Common Dosages:**
- Adults: 500mg - 1000mg every 4-6 hours
- Maximum daily dose: 4000mg (4g)
- Children: Dose based on weight (consult doctor)

**How to Take:**
- Take with or without food
- Drink a full glass of water (250ml) with each dose
- Do not exceed recommended dose

**Common Side Effects:**
- Generally well-tolerated
- Rare: nausea, rash, liver problems (with overdose)

**Precautions:**
- Avoid alcohol while taking paracetamol
- Check other medications for paracetamol content
- Consult doctor if you have liver problems
- Do not use for more than 10 days without consulting a doctor`;
            } else if (lowerQuery.includes('fever')) {
                return `**Medicines for Fever:**

**1. Paracetamol (Acetaminophen)**
- Strength: 500mg, 650mg tablets
- Dosage: 500-1000mg every 4-6 hours
- Water: 250ml per dose
- Best for: General fever, safe for most people

**2. Ibuprofen**
- Strength: 200mg, 400mg tablets
- Dosage: 200-400mg every 4-6 hours
- Water: 250ml per dose
- Best for: Fever with inflammation

**3. Aspirin**
- Strength: 325mg, 500mg tablets
- Dosage: 325-650mg every 4 hours
- Water: 250ml per dose
- NOT for children under 18

**Important:**
- Drink plenty of fluids
- Rest adequately
- Consult doctor if fever persists more than 3 days
- Seek immediate medical attention if fever exceeds 103¬∞F (39.4¬∞C)`;
            } else if (lowerQuery.includes('headache')) {
                return `**Medicines for Headache:**

**1. Paracetamol**
- Dosage: 500-1000mg every 4-6 hours
- Water: 250ml
- Good for: Mild to moderate headaches

**2. Ibuprofen**
- Dosage: 200-400mg every 4-6 hours
- Water: 250ml
- Good for: Tension headaches, migraines

**3. Aspirin**
- Dosage: 325-650mg every 4 hours
- Water: 250ml
- Good for: Various types of headaches

**Additional Tips:**
- Stay hydrated - drink 8 glasses of water daily
- Rest in a quiet, dark room
- Apply cold or warm compress
- Avoid triggers (stress, lack of sleep, certain foods)
- Consult doctor for frequent or severe headaches`;
            } else {
                return `**Information about: ${query}**

I don't have specific information about "${query}" in my database. 

**For accurate medical information, please:**
- Consult with a healthcare professional
- Visit a pharmacy and speak with a pharmacist
- Check the medicine package insert
- Contact your doctor

**General Medicine Safety Tips:**
- Always read the label carefully
- Take medicines as prescribed
- Drink adequate water with tablets (usually 250ml)
- Don't mix medicines without consulting a doctor
- Store medicines in a cool, dry place
- Keep medicines out of reach of children
- Check expiry dates before use

**When to seek medical help:**
- Symptoms persist or worsen
- Severe side effects occur
- Allergic reactions (rash, swelling, difficulty breathing)
- Medication doesn't work as expected`;
            }
        }

        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    if (window.firebaseAuth) {
                        await window.firebaseAuth.signOut();
                    }
                    window.location.href = 'index.html';
                } catch (error) {
                    console.error('Logout error:', error);
                    window.location.href = 'index.html';
                }
            }
        }

        // Allow Enter key to search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchMedicine();
            }
        });
    </script>
</body>
</html>